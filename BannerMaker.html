<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Banner Maker</title>
  <link rel="stylesheet" href="https://use.typekit.net/tne4lpa.css">
</head>

<body>
  <header>
    <h1 class="header-title">
      Banner Maker
    </h1>
    <button id="dl-btn" type="button">
      <img src="assets/img/btn_dl.svg" alt="Download Icon" />
      Export Banner
    </button>
  </header>

  <main>
    <div class="input-section">
      <div class="input-group" title="Banner Text">
        <label for="input-txt">
          <img src="assets/img/input_txt.svg" alt="Text Icon" />
        </label>
        <input id="input-txt" type="text" placeholder="Banner Text" />
      </div>
      <div class="input-group" title="Text Color">
        <label for="input-txt-color">
          <img src="assets/img/input_txt_color.svg" alt="Color Icon" />
        </label>
        <input id="input-txt-color" type="color" />
      </div>
      <div class="input-group" title="Card Tint Color">
        <label for="input-card-tint">
          <img src="assets/img/input_card_tint.svg" alt="Tint Icon" />
        </label>
        <input id="input-card-tint" type="color" />
      </div>
      <div class="input-group" title="Banner Image">
        <label for="input-img">
          <img src="assets/img/input_img.svg" alt="Image Icon" />
        </label>
        <input id="input-img" type="file" accept="image/*" />
      </div>
      <div class="input-group" title="Fix Banner Width [px]">
        <label for="input-fix-width">
          <img src="assets/img/input_fix_width.svg" alt="Text Icon" />
        </label>
        <input id="input-fix-width" type="number" placeholder="Fix Banner Width in Pixels" />
      </div>
      <div class="input-group" title="Fix Banner Height [px]">
        <label for="input-fix-height">
          <img src="assets/img/input_fix_height.svg" alt="Text Icon" />
        </label>
        <input id="input-fix-height" type="number" placeholder="Fix Banner Height in Pixels" />
      </div>
    </div>

    <div class="preview-container">
      <div id="banner-preview">
        <img id="preview-img" alt="Banner Image">
        <div id="preview-card">
          <div id="preview-txt" />
        </div>
      </div>
    </div>
  </main>

  <style>
    :root {
      --app-font: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      --red-50:#FEF2F2; --red-100:#FEE2E2; --red-200:#FECACA; --red-300:#FCA5A5; --red-400:#F87171; --red-500:#EF4444; --red-600:#DC2626; --red-700:#B91C1C; --red-800:#991B1B; --red-900:#7F1D1D; --red-950:#450A0A;
      --gray-50:#FAFAFA; --gray-100:#F5F5F5; --gray-200:#E5E5E5; --gray-300:#D4D4D4; --gray-400:#A3A3A3; --gray-500:#737373; --gray-600:#525252; --gray-700:#404040; --gray-800:#262626; --gray-900:#171717; --gray-950:#0A0A0A;
      --border-1-color: color-mix(in srgb, var(--red-500) 40%, transparent);
      --border-2-color: color-mix(in srgb, var(--gray-500) 60%, transparent);
      --btn-1-bg-color: color-mix(in srgb, var(--red-500) 60%, transparent);
      --btn-1-bg-hover-color: color-mix(in srgb, var(--red-500) 70%, transparent);
      --btn-2-bg-color: color-mix(in srgb, var(--gray-700) 60%, transparent);
      --btn-2-bg-hover-color: color-mix(in srgb, var(--gray-700) 70%, transparent);
    }

    * { box-sizing: border-box }

    body {
      margin: 0; padding: 0;
      font-size: 1rem;
      font-family: var(--app-font);
      color: var(--gray-100);
      background-color: var(--gray-950);
    }

    header {
      width: 100%;
      padding: 16px 24px;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 0 0 0.5px var(--border-2-color);
    }

    main {
      margin: 40px auto;
      max-width: 900px;
      padding: 0 24px;
    }

    button {
      gap: 8px;
      padding: 5px 9px;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      font-weight: 500;
      font-family: inherit;
      color: var(--gray-100);
      border: 1px solid var(--gray-700);
      background-color: var(--btn-2-bg-color);
      transition: background-color 200ms ease;
    }
    button:hover { background-color: var(--btn-2-bg-hover-color) }
    button:active { background-color: var(--gray-700) }

    input {
      border: none;
      width: 100%;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 0.875rem;
      font-family: var(--app-font);
      color: var(--gray-100);
      caret-color: var(--gray-100);
      box-shadow: 0 0 0 0.5px var(--border-2-color);
      background-color: var(--gray-950);
      transition: box-shadow 200ms ease;
    }
    input::placeholder { color: var(--gray-500) }
    input:focus {
      outline: none;
      box-shadow: 0 0 0 1.5px var(--red-500);
    }

    input[type="color"] {
      cursor: pointer;
      height: 40px;
      padding: 4px;
    }
    input[type="color"]::-webkit-color-swatch-wrapper { padding: 0 }
    input[type="color"]::-webkit-color-swatch {
      border: none;
      border-radius: 4px;
    }

    input[type="file"] {
      cursor: pointer;
      padding: 8px;
      font-size: 0.875rem;
      color: var(--gray-300);
    }
    input[type="file"]::file-selector-button {
      cursor: pointer;
      padding: 5px 9px;
      margin-right: 14px;
      border-radius: 6px;
      font-weight: 500;
      font-family: inherit;
      color: var(--gray-100);
      border: 1px solid color-mix(in srgb, var(--border-2-color) 60%, transparent);
      background-color: var(--btn-2-bg-color);
      transition: background-color 200ms ease;
    }
    input[type="file"]::file-selector-button:hover { background-color: var(--btn-2-bg-hover-color) }

    #dl-btn {
      gap: 10px;
      padding: 7px 12px;
      font-size: 1rem;
      border: 1px solid color-mix(in srgb, var(--border-1-color) 60%, transparent);
      background-color: var(--btn-1-bg-color);

      img {
        width: 16px;
        height: 16px;
        filter: brightness(0) invert(1);
      }
    }
    #dl-btn:hover { background-color: var(--btn-1-bg-hover-color) }
    #dl-btn:active { background-color: var(--btn-1-bg-color) }
    #dl-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    #banner-preview {
      width: 100%;
      margin: 1px;
      border-radius: 12px;
      overflow: clip;
      position: relative;
      box-shadow: 0 0 0 0.5px var(--border-2-color);
      background-color: var(--gray-900);
    }

    #preview-txt {
      opacity: 0.8;
      position: relative;
      pointer-events: none;
      mix-blend-mode: multiply;
      font-size: 3.5rem;
      font-weight: 900;
      font-family: "interstate", sans-serif;
      font-style: normal;
      text-shadow:
        0 -2px 5px color-mix(in srgb, var(--txt-shadow-color) 25%, transparent),
        0 -1px 0.5px color-mix(in srgb, var(--txt-shadow-color) 20%, black 14%),
        0 1px 2px color-mix(in srgb, var(--txt-shadow-color) 20%, white 80%);
    }

    #preview-card {
      z-index: 1;
      top: 50%;
      left: 50%;
      max-width: 90%;
      padding: 20px 30px;
      border-radius: 20px;
      transform: translate(-50%, -50%);
      width: max-content;
      position: absolute;
      text-align: center;
      box-shadow:
        0 2px 4px 0 color-mix(in srgb, var(--gray-950) 10%, transparent),
        0 8px 16px 0 color-mix(in srgb, var(--gray-950) 20%, transparent),
        0 16px 48px 0 color-mix(in srgb, var(--gray-950) 30%, transparent),
        inset 0 0 0 1px color-mix(in srgb, var(--gray-50) 6%, transparent),
        inset 2px 4px 4px 0 color-mix(in srgb, var(--gray-50) 12%, transparent);
      backdrop-filter: blur(12px) saturate(180%);
    }
    /* NOISE TEXTURE OVERLAY */
    #preview-card::after {
      content: '';
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      opacity: 0.15;
      position: absolute;
      border-radius: inherit;
      pointer-events: none;
      mix-blend-mode: overlay;
      background-image: var(--noise-texture);
    }

    #preview-img {
      width: 100%;
      height: 100%;
      display: none;
      object-fit: cover;
    }
    #preview-img.loaded { display: block }

    .header-title {
      margin: 0;
      font-size: 2rem;
      font-weight: 700;
      font-family: "interstate", sans-serif;
      font-style: italic;
    }

    .input-section {
      gap: 16px;
      margin-bottom: 40px;
      display: flex;
      flex-direction: column;

      .input-group {
        gap: 12px;
        display: flex;
        flex-direction: row;
        align-items: center;

        label {
          width: 20px;
          height: 100%;
          display: flex;
          align-items: center;
          justify-content: center;

          img {
            height: 20px;
            filter: brightness(0) invert(40%);
          }
        }
      }
    }

    .preview-container {
      width: 100%;
      overflow: auto;
    }
  </style>

  <script>
    const initTxt = 'Sample Banner Text';
    const initTxtColor = '#FFFFFF';
    const initCardTint = '#FFFFFF';
    const initImg = 'assets/img/banner_img_sample.jpg';
    const initFixWidth = null;
    const initFixHeight = 320;

    const inputTxt = document.getElementById('input-txt');
    const inputTxtColor = document.getElementById('input-txt-color');
    const inputCardTint = document.getElementById('input-card-tint');
    const inputImg = document.getElementById('input-img');
    const inputFixWidth = document.getElementById('input-fix-width');
    const inputFixHeight = document.getElementById('input-fix-height');
    const bannerPreview = document.getElementById('banner-preview');
    const previewTxt = document.getElementById('preview-txt');
    const previewCard = document.getElementById('preview-card');
    const previewImg = document.getElementById('preview-img');

    let currentImg = null;

    function setInitValues() {
      inputTxt.value = initTxt;
      inputTxtColor.value = initTxtColor;
      inputCardTint.value = initCardTint;
      inputFixWidth.value = initFixWidth;
      inputFixHeight.value = initFixHeight;
      previewTxt.textContent = initTxt;
      previewTxt.style.color = initTxtColor;
      previewTxt.style.setProperty('--txt-shadow-color', initTxtColor);
      updateCardTint(initCardTint);

      setFixWidth(initFixWidth);
      setFixHeight(initFixHeight);

      fetch(initImg)
        .then(response => response.blob())
        .then(blob => {
          const reader = new FileReader();
          reader.onload = (e) => {
            currentImg = e.target.result;
            previewImg.src = currentImg;
            previewImg.classList.add('loaded');
          };
          reader.readAsDataURL(blob);
        })
        .catch(err => {
          bannerPreview.style.height = '320px';
          console.warn('Couldn\'t load sample image:', err);
        });
    }

    setInitValues();

    function setFixWidth(width = null) {
      if (width == null || isNaN(width)) {
        bannerPreview.style.width = 'auto';
      }
      else {
        if (width < 500) {
          width = 500;
        } else if (width > 10_000) {
          width = 10_000;
          inputFixWidth.value = width;
        }
        bannerPreview.style.width = `${width}px`;
      }
    }

    function setFixHeight(height = null) {
      if (height == null || isNaN(height)) {
        bannerPreview.style.height = 'auto';
      }
      else {
        if (height < 140) {
          height = 140;
        } else if (height > 1000) {
          height = 1000;
          inputFixHeight.value = height;
        }
        bannerPreview.style.height = `${height}px`;
      }
    }

    // UPDATE TEXT CONTENT
    inputTxt.addEventListener('input', (e) => {
      previewTxt.textContent = e.target.value || '';
    });

    // UPDATE TEXT COLOR
    inputTxtColor.addEventListener('input', (e) => {
      previewTxt.style.color = e.target.value;
      previewTxt.style.setProperty('--txt-shadow-color', e.target.value);
    });

    // UPDATE CARD TINT COLOR
    inputCardTint.addEventListener('input', (e) => {
      updateCardTint(e.target.value);
    });

    function hexToRgb(hex) {
      const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
      } : { r: 255, g: 255, b: 255 };
    }

    function updateCardTint(color) {
      const rgb = hexToRgb(color);
      const bgGradient = `linear-gradient(135deg, 
        rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.25) 0%, 
        rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.15) 100%)`;
      previewCard.style.background = bgGradient;
    }

    // HANDLE IMAGE UPLOAD
    inputImg.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (event) => {
          currentImg = event.target.result;
          previewImg.src = currentImg;
          previewImg.classList.add('loaded');
          setFixWidth(parseInt(inputFixWidth.value, 10));
          setFixHeight(parseInt(inputFixHeight.value, 10));
        };
        reader.readAsDataURL(file);
      }
      else {
        setFixHeight(320);
      }
    });

    // HANDLE FIX WIDTH INPUT
    inputFixWidth.addEventListener('input', (e) => {
      setFixWidth(parseInt(e.target.value, 10));
    });

    // HANDLE FIX HEIGHT INPUT
    inputFixHeight.addEventListener('input', (e) => {
      setFixHeight(parseInt(e.target.value, 10));
    });

    // DYNAMIC NOISE TEXTURE GENERATION
    function generateNoiseTexture(width, height) {
      const svg = `
        <svg viewBox='0 0 ${width} ${height}' xmlns='http://www.w3.org/2000/svg'>
          <filter id='noiseFilter'>
            <feTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/>
          </filter>
          <rect width='100%' height='100%' filter='url(#noiseFilter)'/>
        </svg>
      `.trim();
      
      const encoded = encodeURIComponent(svg);
      return `url("data:image/svg+xml,${encoded}")`;
    }

    function updateNoiseTexture() {
      const rect = previewCard.getBoundingClientRect();
      const noiseUrl = generateNoiseTexture(Math.ceil(rect.width), Math.ceil(rect.height));
      previewCard.style.setProperty('--noise-texture', noiseUrl);
    }

    // DEBOUNCE FUNCTION TO PREVENT EXCESSIVE CALLS
    let resizeTimeout;
    function debounce(func, delay) {
      return function() {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(func, delay);
      };
    }

    const resizeObserver = new ResizeObserver(debounce(() => updateNoiseTexture(), 100));
    resizeObserver.observe(previewCard);

    updateNoiseTexture();
  </script>
</body>

</html>
